{% extends 'labreqsys/base.html' %}
{% load static tailwind_tags %}

{% block content %}
<div class="breadbuttons my-4 flex justify-between items-center w-full">
    <ul class="mb-4 flex items-center text-xs">
        <a href="{% url 'labRequests' requested_status=0 %}" class="text-gray-600 hover:text-gray-900">Lab Requests</a>
        <span class="mx-2 text-gray-600">/</span>

        <a href="{% url 'view_individual_lab_request' request_id=line_item.request.request_id %}" class="text-gray-600 hover:text-gray-900">View Lab Request</a>
        <span class="mx-2 text-gray-600">/</span>

        <span class="text-[#00BAFF]">View Lab Result</span>
    </ul>
    <a href="{% url 'view_individual_lab_request' request_id=line_item.request.request_id %}">
        <button class="px-4 py-2 no-underline bg-myblue-secondary text-blue-900 font-medium text-sm border-myblue-borderPrimary border rounded-lg" type="button">
            Back
        </button>
    </a>
</div>

<div class="w-full h-hug p-8 bg-white rounded-lg shadow-lg inline-flex flex-col justify-start items-start gap-2 overflow-hidden">
    
        <div class="flex items-center justify-between">
            <div class="flex items-center justify-start rtl:justify-end">
            <!--LOGO-->                    
                <img src="{% static 'images/drmed_full.png' %}" class="h-10 me-3" alt="DRMed Logo" />  
            </div>
            <div class="flex items-center">
                <div class="flex items-center ms-3">
                <div>
                    <span class="text-wrapper">
                            4/F NORTHRIDGE PLAZA,<br />
                            CONGRESSIONAL AVE., QUEZON CITY<br />
                    </span>
                </div>               
                </div>
            </div>
        </div>
        

    <!--SECTION 1: PATIENT INFORMATION-->
    <div class="self-stretch inline-flex flex-col justify-start items-start gap-2.5"> <!--section1-->
        <!--Section title: Patient Information-->
        <div class="self-stretch py-2 px-2.5 border-b border-black/20 inline-flex justify-center items-center gap-1.5">
        </div>

        <!--Section Content-->
        <div class="self-stretch inline-flex justify-start items-start gap-4"> <!--both columns-->
            <div class="inline-flex flex-col justify-start items-start gap-1.5"> <!--indiv column-->
                <!--PATIENT ID-->
                <div class="inline-flex justify-start items-center gap-1.5">
                    <div class="w-36 py-2.5 px-2.5 flex justify-start items-center gap-1.5">
                        <div class="w-28 justify-center text-sm font-semibold text-blue-900"> Patient ID </div>
                    </div>
                    <div class="px-6 py-1 bg-gray-100 rounded-3xl flex justify-center items-center gap-1.5">
                        <div class="justify-center text-black text-xs">{{patient.patient_id}}</div>
                    </div>
                </div>

                <div class="inline-flex justify-start items-start gap-1.5"> <!--info row-->
                    <div class="flex-1 px-2.5 flex justify-start items-center gap-1.5"> <!--indiv info-->
                        <div class="w-28 justify-center text-sm font-semibold text-blue-900">Patient Name</div>
                    </div>
                    <div class="flex-1 px-2.5 flex justify-start items-center gap-1.5"> <!--indiv info-->
                        <div class="w-36 justify-center text-sm text-black font-normal">{{patient.last_name}}, {{patient.first_name}}{% if patient.suffix %} {{patient.suffix}}{% endif %}{% if patient.middle_initial %}, {{patient.middle_initial}}.{% endif %}</div>
                    </div>
                </div>

                <div class="inline-flex justify-start items-start gap-1.5"> <!--info row-->
                    <div class="flex-1 px-2.5 flex justify-start items-center gap-1.5"> <!--indiv info-->
                        <div class="w-28 justify-center text-sm font-semibold text-blue-900 ">Age</div>
                    </div>
                    <div class="flex-1 px-2.5 flex justify-start items-center gap-1.5"> <!--indiv info-->
                        <div class="w-36 justify-center text-sm text-black font-normal">{{age}}</div>
                    </div>
                </div>

                <div class="inline-flex justify-start items-start gap-1.5"> <!--info row-->
                    <div class="flex-1 px-2.5 flex justify-start items-center gap-1.5"> <!--indiv info-->
                        <div class="w-28 justify-center text-sm font-semibold text-blue-900 ">Civil Status</div>
                    </div>
                    <div class="flex-1 px-2.5 flex justify-start items-center gap-1.5"> <!--indiv info-->
                        <div class="w-36 justify-center text-sm text-black font-normal">{{patient.civil_status}}</div>
                    </div>
                </div>

                

                <div class="inline-flex justify-start items-start gap-1.5"> <!--info row-->
                    <div class="flex-1 px-2.5 flex justify-start items-center gap-1.5"> <!--indiv info-->
                        <div class="w-28 justify-center text-sm font-semibold text-blue-900 ">Birthday</div>
                    </div>
                    <div class="flex-1 px-2.5 flex justify-start items-center gap-1.5"> <!--indiv info-->
                        <div class="w-36 justify-center text-sm text-black font-normal">{{patient.birthdate}}</div>
                    </div>
                </div>
                <div class="inline-flex justify-start items-start gap-1.5"> <!--info row-->
                    <div class="flex-1 px-2.5 flex justify-start items-center gap-1.5"> <!--indiv info-->
                        <div class="w-28 justify-center text-sm font-semibold text-blue-900 ">Mobile No.</div>
                    </div>
                    <div class="flex-1 px-2.5 flex justify-start items-center gap-1.5"> <!--indiv info-->
                        <div class="w-72 justify-center text-sm text-black font-normal">{{patient.mobile_num}}</div>
                    </div>
                </div>
                

            </div>
            

            <!--COLUMN 2-->
            <div class="inline-flex flex-col justify-start items-start gap-1.5"> <!--indiv column: Column 2-->

                <div class="inline-flex justify-start items-start gap-1.5"> <!--info row-->
                    <div class="flex-1 px-2.5 flex justify-start items-center gap-1.5"> <!--indiv info-->
                        <div class="w-28 justify-center text-sm font-semibold text-blue-900 ">Date Requested</div>
                    </div>
                    <div class="px-6 py-1 bg-gray-100 rounded-3xl flex justify-center items-center gap-1.5">
                        <div class="justify-center text-black text-xs">{{lab_request.date_requested}}</div>
                    </div>
                </div>

                <div class="inline-flex justify-start items-start gap-1.5"> <!--info row-->
                    <div class="flex-1 px-2.5 flex justify-start items-center gap-1.5"> <!--indiv info-->
                        <div class="w-28 justify-center text-sm font-semibold text-blue-900 ">Landline No.</div>
                    </div>
                    <div class="flex-1 px-2.5 flex justify-start items-center gap-1.5"> <!--indiv info-->
                        <div class="w-72 justify-center text-sm text-black font-normal">{{patient.landline_num}}</div>
                    </div>
                </div>

                <div class="inline-flex justify-start items-start gap-1.5"> <!--info row-->
                    <div class="flex-1 px-2.5 flex justify-start items-center gap-1.5"> <!--indiv info-->
                        <div class="w-28 justify-center text-sm font-semibold text-blue-900 ">Email</div>
                    </div>
                    <div class="flex-1 px-2.5 flex justify-start items-center gap-1.5"> <!--indiv info-->
                        <div class="w-72 justify-center text-sm text-black font-normal">{{patient.email}}</div>
                    </div>
                </div>

                <div class="inline-flex justify-start items-start gap-1.5"> <!--info row-->
                    <div class="flex-1 px-2.5 flex justify-start items-center gap-1.5"> <!--indiv info-->
                        <div class="w-28 justify-center text-sm font-semibold text-blue-900 ">Address</div>
                    </div>
                    <div class="flex-1 px-2.5 flex justify-start items-center gap-1.5"> <!--indiv info-->
                        <div class="w-72 justify-center text-sm text-black font-normal text-start">{{address}}</div>
                    </div>
                </div>

                <div class="inline-flex justify-start items-start gap-1.5"> <!--info row-->
                    <div class="flex-1 px-2.5 flex justify-start items-center gap-1.5"> <!--indiv info-->
                        <div class="w-28 justify-center text-sm font-semibold text-blue-900 ">Physician</div>
                    </div>
                    <div class="flex-1 px-2.5 flex justify-start items-center gap-1.5"> <!--indiv info-->
                        <div class="w-72 justify-center text-sm text-black font-normal text-start">{{lab_request.physician}}</div>
                    </div>
                </div>
            </div>
        </div> 
        <div class="self-stretch py-2 px-2.5 border-b border-black/20 inline-flex justify-center items-center gap-1.5">
        </div>
    </div>
    
    <div class="self-stretch flex-col justify-start items-start gap-2.5 w-full"> <!--section2-->
        
        <h1 class="text-mm font-semibold text-blue-900 flex items-center">{{template_form.template_name}}</h1>
        <div class = "relative overflow-x-auto rounded-xl ">
            {% for section, row in form.items %}
                {{section.section_name}} <!--FOR BACKEND PURPOSE ONLY ! can remove later :)-->
                <table class="w-full bg-white rounded-xl text-left rtl:text-right justify-start text-gray-500 items-start relative overflow-x-auto">
                    <thead class="flex-1 justify-center items-start overflow-hidden uppercase">
                        <tr class="self-stretch h-[42px] bg-gray-50 text-gray-450 border-b gap-2.5 justify-start text-xs">
                            {% for field in row %}
                                <th scope="col" class="p-3 text-center">{{field.label_name}}</th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for field, values in row.items %}
                            {% if values %} 
                                {% for value in values %}
                                    {% if value.field_type == 'Image'%}
                                    <td>
                                        <img src = "{% static value.field_value %}" alt ="{{value.field.field_type}}_{{patient.last_name}}_{{lab_request.date_requested}}">
                                    </td>
                                    {% else %}
                                        <td scope="col" class="p-3 text-center"> {{value.field_value}} </td>
                                    {% endif %}
                                {% endfor %}
                            {% else %}
                                <td scope="col" class="p-3 text-center">{{field.field_value}}</td>
                            {% endif %}                
                        {% endfor %}
                    </tbody>
                </table>
                {% endfor %}
        </div>
    </div>

    <div class="self-stretch py-2 px-2.5 border-b border-black/20 inline-flex justify-center items-center gap-1.5">
    </div>
    
    <!--SIGNATURE-->
    <div class="self-stretch inline-flex flex-col justify-start items-start gap-2.5"> <!--section-->
        <table class="w-full bg-white rounded-xl text-left rtl:text-right justify-start text-gray-500 items-start relative overflow-x-auto">
            <thead class="flex-1 justify-center items-start overflow-hidden uppercase">
                <tr class="self-stretch h-[42px] text-gray-450 gap-2.5 justify-start text-xs">
                {% for tech in lab_tech %}
                <td class="text-center p-3 align-top">
                    <div class="flex flex-col items-center justify-center gap-1">
                        <img class="h-16 w-96 object-contain" src="{% static tech.lab_tech.signature_path %}" alt="{{tech.lab_tech.signature_path}}">
                        <div>
                            <div class="underline text-sm text-black capitalize">{{ tech.lab_tech.first_name }} {{ tech.lab_tech.last_name }}</div>
                            <div class="font-semibold text-sm text-black">{{ tech.lab_tech.title }}</div> <!--how do i make it show the whole title instead?-->
                            <div class="text-xs">{{ tech.lab_tech.license_num }}</div>
                        </div>
                    </div>
                </td>
                {% endfor %}

                </tr>
            
        </table>
    </div>

    <div class="flex justify-center items-center w-full">  <!-- adjust height as needed -->
        <p class="text-center text-xs text-gray-500 font-medium">*** End of Report ***</p>
    </div>

</div>


{% endblock content %}

{% block styles %}
{% endblock styles %}